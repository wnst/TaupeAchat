<?phpfunction enregistrerCommande(){	extract($_SESSION['livraison']);		//on génère le numéro de commande en fonction de la date et de l'id du client pour éviter les doublons au cas où un nombre important de clients passeraient commande en même temps	$date = getdate(time());	$id_com = $date[0].$_SESSION['id'];	mysql_query('insert into commande (id_com, id_client, date, civilite, nom, prenom, adresse, cp, ville, telephone) values("'.$id_com.'","'.$_SESSION['id'].'","'.$date[0].'","'.$civilite.'","'.$nom.'","'.$prenom.'","'.$adresse.'","'.$cp.'","'.$ville.'","'.$telephone.'")');	foreach($_SESSION['panier'] as $id_prod=>$data) mysql_query('insert into detail (id_com, id_prod, quantite) values("'.$id_com.'","'.$id_prod.'","'.$data['Quantite'].'")');		unset($_SESSION['livraison']);}function paiement(){	if(isset($_SESSION['erreur'])) unset($_SESSION['erreur']);	//si le paiement s'est déroulé sans erreur alors on enregistre la commande dans la bdd	if(!isset($_SESSION['erreur']))	{		enregistrerCommande();				//on vide le panier		unset($_SESSION['panier']);		setcookie('panier', '', time() + 60*3600, null, null, false, true);				$_SESSION['message'] = '<div style="text-align:center"><h1>Paiement accepté! Merci d\'avoir choisi TaupeAchat!</h1><br /><br /><a href="index.php">Cliquez ici pour retourner à l\'accueil.</a></div>';		header('Location: message.php');	}}function afficherFormulaire($data){	foreach($data as $elt)	{		echo '<br /><br />			<label for="'.$elt['name'].'" class="formLabel2">'.$elt['label'].'</label>';			//s'il y a une erreur concernant cet input alors on affiche l'erreur à côté de l'input			if(isset($_SESSION['erreur'][$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'"/><span class="erreur">'.$_SESSION['erreur'][$elt['name']].'</span>';			else			{	//s'il n'y a pas d'erreur alors on initialise l'input avec la valeur entrée par l'utilisateur (pour le else il n'y a pas de valeur à afficher car l'utilisateur vient d'arriver sur la page)				if(isset($_POST[$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'" value="'.$_POST[$elt['name']].'"/>';				else echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'"/>';			};	}}function afficherPaiement(){	echo '<h1>Etape 2/2</h1><br /><br />	<form action="paiement.php" method="post">		<div>					<div class="formCadre">				<input type="radio" name="mode" value="cb" style="float:left; margin-left:0px; margin-right:5px" checked="checked"/><h2>Paiement par carte bancaire</h2>';				$data[] = array('name'=>'nom', 'type'=>'text', 'label'=>'Votre nom tel qu\'il apparaît sur la carte:', 'class'=>'inputMoyen');								$data[] = array('name'=>'num', 'type'=>'text', 'label'=>'Numéro de la carte:', 'class'=>'inputMoyen');								$data[] = array('name'=>'code', 'type'=>'password', 'label'=>'Code (3 chiffres au dos de la carte):', 'class'=>'inputMoyen');							afficherFormulaire($data);				unset($data);								echo '<br /><br /><label class="formLabel2" style="margin-right:28px">Date d\'expiration:</label>';								echo '<select style="margin-right:5px">						<option>01</option>						<option>02</option>						<option>03</option>						<option>04</option>						<option>05</option>						<option>06</option>						<option>07</option>						<option>08</option>						<option>09</option>						<option>10</option>						<option>11</option>						<option>12</option>					</select>';									$date = getdate(time());				echo '<select>';					for($i=0; $i<11; $i++) echo '<option>'.($date['year']+$i).'</option>';				echo '</select>';						echo'</div><br />						<div class="formCadre">				<input type="radio" name="mode" value="paypal" style="float:left; margin:0px; margin-right:5px"/><h2>Paiement par Paypal</h2>';				$data[] = array('name'=>'login', 'type'=>'text', 'label'=>'Login:', 'class'=>'inputMoyen');								$data[] = array('name'=>'mdp', 'type'=>'text', 'label'=>'Mot de passe:', 'class'=>'inputMoyen');								afficherFormulaire($data);				unset($data);					echo'</div><br />						<input id="submit" name="paiement" type="submit" value="Valider" style="margin:0px"/>					</div>	</form>';}?>