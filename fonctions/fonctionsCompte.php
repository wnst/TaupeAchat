<?phpfunction verifierAdresse(){	if(isset($_SESSION['erreur'])) unset($_SESSION['erreur']);		//si l'utilisateur a validé le forumulaire de livraison	if(isset($_POST['livraison']))	{		extract($_POST);		foreach($_POST as $key => $val)		{			//on vérifie qu'aucun champ n'est vide			if(str_replace(' ', '', $val) == '') $_SESSION['erreur'][$key] = 'Entrée invalide.';		}				if(!preg_match('/^[0-9]{5}$/', $cp))		{			if(!isset($_SESSION['erreur']['cp'])) $_SESSION['erreur']['cp'] = 'Code postal invalide.';		}		if(!preg_match('/^0([0-9]{9}$)/', $telephone))		{			if(!isset($_SESSION['erreur']['telephone'])) $_SESSION['erreur']['telephone'] = 'Numéro de téléphone invalide.';		}				//si l'adresse a été complété sans erreur alors on met à jour la base de données		if(!isset($_SESSION['erreur']))		{			mysql_query('update utilisateur set civilite="'.$civilite.'", nom="'.$nom.'", prenom="'.$prenom.'", adresse="'.$adresse.'", cp="'.$cp.'", ville="'.$ville.'", telephone="'.$telephone.'" where id="'.$_SESSION['id'].'"');			$_SESSION['message'] = '<div style="text-align:center"><h1>Votre adresse a été mise à jour avec succés!</h1><br /><br /><a href="compte.php">Cliquez ici pour retourner sur votre compte.</a></div>';			header('Location: message.php');		}	}}function afficherFormulaire($data){	foreach($data as $elt)	{		echo '<br /><br />			<label for="'.$elt['name'].'" class="formLabel">'.$elt['label'].'</label>';			//s'il y a une erreur concernant cet input alors on affiche l'erreur à côté de l'input			if(isset($_SESSION['erreur'][$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'"/><span class="erreur">'.$_SESSION['erreur'][$elt['name']].'</span>';			else			{	//s'il n'y a pas d'erreur alors on initialise l'input avec la valeur entrée par l'utilisateur (pour le else il n'y a pas de valeur à afficher car l'utilisateur vient d'arriver sur la page)				if(isset($_POST[$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'" value="'.$_POST[$elt['name']].'"/>';				else echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'" value="'.$elt['value'].'"/>';			};	}}function afficherCompte(){	$result = mysql_query('select civilite, nom, prenom from utilisateur where id="'.$_SESSION['id'].'"');	$entete = mysql_fetch_assoc($result);		echo '<h1>Bonjour '.$entete['civilite'].'. '.ucfirst(strtolower($entete['prenom'])).' '.strtoupper($entete['nom']).'</h1><br /><br />';		if(isset($_GET['action']) && $_GET['action']=='adresse')	{		echo '<form action="compte.php?action=adresse" method="post">			<div>								<div class="formCadre">					<h2>Adresse de livraison</h2>';					$result = mysql_query('select civilite, nom, prenom, adresse, cp, ville, telephone from utilisateur where id="'.$_SESSION['id'].'"');					$adresse = mysql_fetch_assoc($result);					echo '<br /><br /><label class="formLabel">Civilité:</label>';										//si l'utilisateur a validé le formulaire mais qu'il y a des erreurs, alors on recoche la civilité qu'il avait précedemment sélectionnée					if(isset($_POST['livraison'])) $adresse['civilite'] = $_POST['civilite'];										if($adresse['civilite']!='M') echo '<input type="radio" name="civilite" value="M" style="margin-left:0px"/>M.';					else echo '<input type="radio" name="civilite" value="M" checked="checked" style="margin-left:0px"/>M.';					if($adresse['civilite']!='Mme') echo '<input type="radio" name="civilite" value="Mme"/>Mme.';					else echo '<input type="radio" name="civilite" value="Mme" checked="checked"/>Mme.';										if($adresse['civilite']!='Mlle') echo '<input type="radio" name="civilite" value="Mlle"/>Mlle.';					else echo '<input type="radio" name="civilite" value="Mlle" checked="checked"/>Mlle.';										$data[] = array('name'=>'nom', 'type'=>'text', 'label'=>'Nom:', 'class'=>'inputMoyen', 'value'=>$adresse['nom']);									$data[] = array('name'=>'prenom', 'type'=>'text', 'label'=>'Prénom:', 'class'=>'inputMoyen', 'value'=>$adresse['prenom']);									$data[] = array('name'=>'adresse', 'type'=>'text', 'label'=>'Adresse:', 'class'=>'inputGrand', 'value'=>$adresse['adresse']);								$data[] = array('name'=>'cp', 'type'=>'text', 'label'=>'Code postal:', 'class'=>'inputPetit', 'value'=>$adresse['cp']);					$data[] = array('name'=>'ville', 'type'=>'text', 'label'=>'Ville:', 'class'=>'inputMoyen', 'value'=>$adresse['ville']);					$data[] = array('name'=>'telephone', 'type'=>'text', 'label'=>'Téléphone:', 'class'=>'inputMoyen', 'value'=>$adresse['telephone']);					afficherFormulaire($data);					unset($data);			echo'</div><br />';							echo '<div style="float:left"><input id="submit" name="livraison" type="submit" value="Valider" style="margin-left:0px"/></div>							</div>		</form>';				echo '<form action="compte.php" method="post"><div style="float:right"><input name="annuler" type="submit" value="Annuler"/></div></form>';	}	else echo '<a href="compte.php?action=adresse">Modifier mon adresse.</a><br /><br />				<a href="compte.php?action=commande">Visualiser mes commandes.</a><br /><br />				<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />';		if(isset($_GET['action']) && $_GET['action']=='commande')	{		echo '<form action="compte.php?action=commande" method="post"><div class="floatRight">';		$result = mysql_query('select * from commande where id_client="'.$_SESSION['id'].'" order by id_com DESC');				echo '<label>N° commande: </label><select name="id_com">';				while($commande = mysql_fetch_assoc($result))		{			if(isset($_POST['id_com']) && $_POST['id_com']==$commande['id_com']) echo '<option selected="selected">'.$commande['id_com'].'</option>';			else echo '<option>'.$commande['id_com'].'</option>';		}				echo '</select>';				echo '<input id="submit" name="voir" type="submit" value="Voir" style="margin:0px"/>';		echo '</div></form>';				//si on a cliqué sur voir		if(isset($_POST['voir']))		{			$result = mysql_query('select * from commande where id_com="'.$_POST['id_com'].'"');						$commande = mysql_fetch_assoc($result);						$date = getdate($commande['date']);						echo '<br /><br /><div class="article">				#'.$_POST['id_com'].'<br />				Date: '.$date['mday'].'/'.$date['mon'].'/'.$date['year'].' à '.$date['hours'].':'.$date['minutes'].':'.$date['seconds'].'<br /><br />'.				$commande['civilite'].'. '.ucfirst(strtolower($commande['prenom'])).' '.strtoupper($commande['nom']).'<br />'.				$commande['adresse'].'<br />'.				$commande['cp'].'<br />'.				$commande['ville'].'<br />'.				$commande['telephone'].'				</div><br /><br />';							$result = mysql_query('select * from detail where id_com="'.$_POST['id_com'].'"');						echo '<div class="entetePanier" style="width:90px">Prix</div>				<div class="entetePanier" style="width:70px; border-right:none">Quantité</div>				<div class="entetePanier" style="width:94px; border-right:none">Prix unitaire</div>';						$i = 1;			$nbArticle = mysql_num_rows($result);						while($article = mysql_fetch_assoc($result))			{				$result2 = mysql_query('select Libelle, Prix from produit where id_prod="'.$article['id_prod'].'"');				$info = mysql_fetch_assoc($result2);								$detail[$article['id_prod']]['Quantite'] = $article['quantite'];				$detail[$article['id_prod']]['Libelle'] = $info['Libelle'];				$detail[$article['id_prod']]['Prix'] = $info['Prix'];			}						foreach($detail as $id_prod => $article)			{				echo '<div class="panier"'; 				if($i != $nbArticle) echo ' style="border-bottom:none"';									echo '>						<div style="float: left; padding: 5px; width:421px">'.$article['Libelle'].'</div>												<div class="colonnePanier" style="width:94px; padding-top:17px;">'.$article['Prix'].' €</div>												<div class="colonnePanier" style="width:70px; padding-top:17px;">'.$article['Quantite'].'</div>												<div class="colonnePanier" style="width:90px; padding-top:17px;">'.$article['Prix'] * $article['Quantite'].' €</div>										</div>';								$i++;			}						$total = 0;						foreach($detail as $article) $total += $article['Prix'] * $article['Quantite'];						echo '<div class="piedPanier">'.$total.' €</div>';		}		}}?>