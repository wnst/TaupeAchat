<?phpfunction generer_sel(){	$minuscules = array('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z');	$majuscules = array('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');	$code = ''; //On déclare notre variable		for ($i = 1; $i <= 40; $i++)		{		//On génère un type aléatoire		$type = rand(0,2);			if ($type == 0)			{				$caractere = rand(0,9);				$code .= $caractere;			}			if ($type == 1)			{				$nbre_aleatoire = rand(0, 25);				$caractere = $majuscules[$nbre_aleatoire];				$code .= $caractere;			}			if ($type == 2)			{				$nbre_aleatoire = rand(0, 25);				$caractere = $minuscules[$nbre_aleatoire];				$code .= $caractere;			}		}	return $code; //On retourne le code généré au complet}function creerUtilisateur(){	if(isset($_SESSION['erreur'])) unset($_SESSION['erreur']);		//si l'utilisateur a validé le forumulaire d'inscription	if(isset($_POST['inscription']))	{		extract($_POST);		foreach($_POST as $key => $val)		{			//on vérifie qu'aucun champ n'est vide			if(str_replace(' ', '', $val) == '') $_SESSION['erreur'][$key] = 'Entrée invalide.';		}				$result = mysql_query('select id from utilisateur where login="'.$login.'"');		if(mysql_num_rows($result)) $_SESSION['erreur']['login'] = 'Ce pseudo est déjà utilisé.';				$result = mysql_query('select email from utilisateur where email="'.$email.'"');		if(mysql_num_rows($result)) $_SESSION['erreur']['email'] = 'Cette adresse email est déjà enregistrée.';				if(!preg_match('#^[\w.-]+@[\w.-]+\.[a-zA-Z]{2,5}$#', $email))		{			if(!isset($_SESSION['erreur']['email'])) $_SESSION['erreur']['email'] = 'Email invalide.';		}				if($mdp != $mdp2)		{			if(!isset($_SESSION['erreur']['mdp']) && !isset($_SESSION['erreur']['mdp2'])) $_SESSION['erreur']['mdp2'] = 'Erreur de confirmation du mot de passe.';		}				if($jour=='Jour' || $mois=='Mois' || $annee=='Année')		{			$_SESSION['erreur']['date'] = 'Date de naissance invalide.';		}				if(!preg_match('/^[0-9]{5}$/', $cp))		{			if(!isset($_SESSION['erreur']['cp'])) $_SESSION['erreur']['cp'] = 'Code postal invalide.';		}				if(!preg_match('/^0([0-9]{9}$)/', $telephone))		{			if(!isset($_SESSION['erreur']['telephone'])) $_SESSION['erreur']['telephone'] = 'Numéro de téléphone invalide.';		}				//si le formulaire a été complété sans erreur alors on enregistre l'utilisateur dans la bdd		if(!isset($_SESSION['erreur']))		{			//On génère un sel pour saler le mot de passe			$sel = generer_sel();			mysql_query('insert into utilisateur (login, sel, mdp, email, jour, mois, annee, rang, civilite, nom, prenom, adresse, cp, ville, telephone) values("'.$login.'", "'.$sel.'", "'.SHA1($mdp).'","'.$email.'","'.$jour.'","'.$mois.'","'.$annee.'","0","'.$civilite.'","'.$nom.'","'.$prenom.'","'.$adresse.'","'.$cp.'","'.$ville.'","'.$telephone.'")');						$result = mysql_query('select id from utilisateur where login="'.$login.'"');			$data = mysql_fetch_row($result);						$_SESSION['id'] = $data[0];			$_SESSION['login'] = $login;			$_SESSION['rang'] = 0;			$_SESSION['message'] = '<div style="text-align:center"><h1>Inscription réussie!</h1><br /><br /><a href="index.php">Cliquez ici pour retourner à l\'accueil.</a></div>';			header('Location: message.php');		}	}}function afficherFormulaire($data){	foreach($data as $elt)	{		echo '<br /><br />			<label for="'.$elt['name'].'" class="formLabel">'.$elt['label'].'</label>';			//s'il y a une erreur concernant cet input alors on affiche l'erreur à côté de l'input			if(isset($_SESSION['erreur'][$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'"/><span class="erreur">'.$_SESSION['erreur'][$elt['name']].'</span>';			else			{	//s'il n'y a pas d'erreur alors on initialise l'input avec la valeur entrée par l'utilisateur (pour le else il n'y a pas de valeur à afficher car l'utilisateur vient d'arriver sur la page)				if(isset($_POST[$elt['name']])) echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'" value="'.$_POST[$elt['name']].'"/>';				else echo '<input class="'.$elt['class'].'" type="'.$elt['type'].'" id="'.$elt['name'].'" name="'.$elt['name'].'"/>';			};	}}function afficherInscription(){	echo '<h1>Inscription</h1><br /><br />	<form action="inscription.php" method="post">		<div>					<div class="formCadre">				<h2>Identifiants</h2>';				$data[] = array('name'=>'login', 'type'=>'text', 'label'=>'Pseudo:', 'class'=>'inputMoyen');								$data[] = array('name'=>'email', 'type'=>'text', 'label'=>'Email:', 'class'=>'inputMoyen');								$data[] = array('name'=>'mdp', 'type'=>'password', 'label'=>'Mot de passe:', 'class'=>'inputMoyen');							$data[] = array('name'=>'mdp2', 'type'=>'password', 'label'=>'Confirmation du mot de passe:', 'class'=>'inputMoyen');					afficherFormulaire($data);								echo '<br /><br />					<label class="formLabel">Date de naissance</label>';									echo '<select name="jour" style="margin-right:5px">						<option>Jour</option>';						for($i=1; $i<32; $i++)						{							if(isset($_POST['jour']) && $_POST['jour']==$i) echo '<option selected="selected">'.$i.'</option>';							else echo '<option>'.$i.'</option>';						}				echo '</select>';								echo '<select name="mois" style="margin-right:5px">						<option>Mois</option>';						for($i=1; $i<13; $i++)						{							if(isset($_POST['mois']) && $_POST['mois']==$i) echo '<option selected="selected">'.$i.'</option>';							else echo '<option>'.$i.'</option>';						}				echo '</select>';								$date = getdate(time());				echo '<select name="annee" style="margin-right:5px">						<option>Année</option>';						for($i=0; $i<101; $i++)						{							if(isset($_POST['annee']) && $_POST['annee']==($date['year']-$i)) echo '<option selected="selected">'.($date['year']-$i).'</option>';							else echo '<option>'.($date['year']-$i).'</option>';						}				echo '</select>';								if(isset($_SESSION['erreur']['date'])) echo '<span class="erreur">'.$_SESSION['erreur']['date'].'</span>';								unset($data);		echo'</div><br />						<div class="formCadre">				<h2>Adresse</h2>';				echo '<br /><br /><label class="formLabel">Civilité:</label><input type="radio" name="civilite" value="M" checked="checked" style="margin-left:0px"/>M.<input type="radio" name="civilite" value="Mme"/>Mme.<input type="radio" name="civilite" value="Mlle"/>Mlle.';				$data[] = array('name'=>'nom', 'type'=>'text', 'label'=>'Nom:', 'class'=>'inputMoyen');								$data[] = array('name'=>'prenom', 'type'=>'text', 'label'=>'Prénom:', 'class'=>'inputMoyen');								$data[] = array('name'=>'adresse', 'type'=>'text', 'label'=>'Adresse:', 'class'=>'inputGrand');							$data[] = array('name'=>'cp', 'type'=>'text', 'label'=>'Code postal:', 'class'=>'inputPetit');				$data[] = array('name'=>'ville', 'type'=>'text', 'label'=>'Ville:', 'class'=>'inputMoyen');				$data[] = array('name'=>'telephone', 'type'=>'text', 'label'=>'Téléphone:', 'class'=>'inputMoyen');				afficherFormulaire($data);				unset($data);		echo'</div><br />						<input id="submit" name="inscription" type="submit" value="Valider" style="margin:0px"/>					</div>	</form>';}?>